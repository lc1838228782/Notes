# Lab3 虚拟内存的管理

## 理论

计算机内存不够用解决方案：

- **覆盖（overlay）**：应用程序手动把需要的指令和数据保存在内存中

- **交换（swapping）**：操作系统自动把暂时不能执行的程序保存至外存中。

  *交换单位：整个进程的地址空间*

- **虚拟存储**：在有限容量的内存中，以页为单位自动装入更过更大的程序

### 虚拟页式存储

目标：由操作系统自动完成，无需程序员操作；交换程序的部分内容。

原理：局部性原理（时间、空间）

![X86页表项结构](https://raw.githubusercontent.com/lc1838228782/pics/master/img/X86%E9%A1%B5%E8%A1%A8%E9%A1%B9%E7%BB%93%E6%9E%84.png)

**虚拟页式存储中的外存选择**：代码段、动态加载的共享程序段：可以直接到原来文件查找（因为没有改变）；其他段：交换空间。

### 页面置换算法

**设计目标**：尽可能减少页面的调入调出次数

**页面锁定（frame locking）**：必须常驻内存的逻辑页面、操作系统的关键部分、要求响应速度的代码和数据、页表中的锁定标志位（lock bit）。

**分类**：

- 局部页面置换算法：置换页面的选择范围仅限于当前进程占用的物理页面内

  最优算法（预测未来）、先进先出算法、最近最久未使用算法（统计过去）

  时钟算法（LRU和FIFO的折中）、最不常使用算法（访问次数）

- 全局页面置换算法：置换页面的选择范围是所有可换出的物理页面

  工作集算法（访存的时候处理）、缺页率算法（缺页的时候处理，缺页率高增加物理页，低->并发数低->减少物理页）

![页面置换算法](https://raw.githubusercontent.com/lc1838228782/pics/master/img/%E9%A1%B5%E9%9D%A2%E7%BD%AE%E6%8D%A2%E7%AE%97%E6%B3%95.png)

**Belady现象**：分配的物理页面增多，缺页率反而上升。有此现象：FIFO、Clock；无：OPT、LRU

## 实验

用`mm_struct`和`vma_struct`模拟用户程序空间，通过`swap_manager`框架进行测试。

