## 4 [æŒ‡é’ˆä¸consté™å®šç¬¦](https://akaedu.github.io/book/ch23s04.html)

`const`å˜é‡ï¼š

```c
const int *a;
int const *a;
```

æŒ‡å‘çš„å†…å­˜å•å…ƒä¸å¯æ”¹å†™ï¼Œaå¯ä»¥æ”¹å†™ã€‚

`const`æŒ‡é’ˆï¼š

```c
int * const a;
```

ç›¸åã€‚

1. é`const`å˜é‡çš„æŒ‡é’ˆæˆ–è€…é`const`å˜é‡çš„åœ°å€å¯ä»¥ä¼ ç»™æŒ‡å‘`const`å˜é‡çš„æŒ‡é’ˆï¼Œç¼–è¯‘å™¨å¯ä»¥åšéšå¼ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚ï¼š

   ```c
   char c = 'a';
   const char *pc = &c;
   ```

2. æŒ‡å‘`const`å˜é‡çš„æŒ‡é’ˆæˆ–è€…`const`å˜é‡çš„åœ°å€ä¸å¯ä»¥ä¼ ç»™æŒ‡å‘é`const`å˜é‡çš„æŒ‡é’ˆï¼Œä»¥å…é€è¿‡åè€…æ„å¤–æ”¹å†™äº†å‰è€…æ‰€æŒ‡å‘çš„å†…å­˜å•å…ƒï¼Œä¾‹å¦‚å¯¹ä¸‹é¢çš„ä»£ç ç¼–è¯‘å™¨ä¼šæŠ¥è­¦å‘Šï¼š

   ```c
   const char c = 'a';
   char *pc = &c;
   ```

### å»ºè®®

å³ä½¿ä¸ç”¨`const`é™å®šç¬¦ä¹Ÿèƒ½å†™å‡ºåŠŸèƒ½æ­£ç¡®çš„ç¨‹åºï¼Œä½†è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯åº”è¯¥å°½å¯èƒ½å¤šåœ°ä½¿ç”¨`const`ï¼Œå› ä¸ºï¼š

1. `const`ç»™è¯»ä»£ç çš„äººä¼ è¾¾éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ã€‚æ¯”å¦‚ä¸€ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯`const char *`ï¼Œä½ åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶å°±å¯ä»¥æ”¾å¿ƒåœ°ä¼ ç»™å®ƒ`char *`æˆ–`const char *`æŒ‡é’ˆï¼Œè€Œä¸å¿…æ‹…å¿ƒæŒ‡é’ˆæ‰€æŒ‡çš„å†…å­˜å•å…ƒè¢«æ”¹å†™ã€‚
2. å°½å¯èƒ½å¤šåœ°ä½¿ç”¨`const`é™å®šç¬¦ï¼ŒæŠŠä¸è¯¥å˜çš„éƒ½å£°æ˜æˆåªè¯»ï¼Œè¿™æ ·å¯ä»¥ä¾é ç¼–è¯‘å™¨æ£€æŸ¥ç¨‹åºä¸­çš„Bugï¼Œé˜²æ­¢æ„å¤–æ”¹å†™æ•°æ®ã€‚
3. `const`å¯¹ç¼–è¯‘å™¨ä¼˜åŒ–æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æç¤ºï¼Œç¼–è¯‘å™¨ä¹Ÿè®¸ä¼šæŠŠ`const`å˜é‡ä¼˜åŒ–æˆå¸¸é‡ã€‚

*æ³¨æ„å­—ç¬¦ä¸²å­—é¢å€¼ğŸ‘‡*

å¦‚æœè¦å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè¿™ä¸ªæŒ‡é’ˆåº”è¯¥æ˜¯`const char *`å‹ï¼Œå¦‚æœå†™æˆ`char *p = "abcd";`å°±ä¸å¥½äº†ï¼Œæœ‰éšæ‚£ï¼Œä¾‹å¦‚ï¼š

```c
int main(void)
{
	char *p = "abcd";
...
	*p = 'A';
...
}
```

`p`æŒ‡å‘`.rodata`æ®µï¼Œä¸å…è®¸æ”¹å†™ï¼Œä½†ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œåœ¨è¿è¡Œæ—¶ä¼šå‡ºç°æ®µé”™è¯¯ã€‚

## 6 æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆä¸æŒ‡é’ˆæ•°ç»„

æœ‰äº›ç¨‹åºä¼šæ ¹æ®ä¸åŒçš„`argv[0]`åšä¸åŒçš„äº‹æƒ…ï¼Œä¾‹å¦‚ä¸“é—¨é’ˆå¯¹åµŒå…¥å¼ç³»ç»Ÿçš„å¼€æºé¡¹ç›®Busyboxï¼Œå°†å„ç§Linuxå‘½ä»¤è£å‰ªåé›†äºä¸€èº«ï¼Œç¼–è¯‘æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶`busybox`ï¼Œå®‰è£…æ—¶å°†`busybox`ç¨‹åºæ‹·åˆ°åµŒå…¥å¼ç³»ç»Ÿçš„`/bin`ç›®å½•ä¸‹ï¼ŒåŒæ—¶åœ¨`/bin`ã€`/sbin`ã€`/usr/bin`ã€`/usr/sbin`ç­‰ç›®å½•ä¸‹åˆ›å»ºå¾ˆå¤šæŒ‡å‘`/bin/busybox`çš„ç¬¦å·é“¾æ¥ï¼Œå‘½åä¸º`cp`ã€`ls`ã€`mv`ã€`ifconfig`ç­‰ç­‰ï¼Œä¸ç®¡æ‰§è¡Œå“ªä¸ªå‘½ä»¤å…¶å®æœ€ç»ˆéƒ½æ˜¯åœ¨æ‰§è¡Œ`/bin/busybox`ï¼Œå®ƒä¼šæ ¹æ®`argv[0]`æ¥åŒºåˆ†ä¸åŒçš„å‘½ä»¤ã€‚

## 7 [æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆä¸å¤šç»´æ•°ç»„](https://akaedu.github.io/book/ch23s07.html)

ä»¥ä¸‹å®šä¹‰ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼ˆ**æ•°ç»„æŒ‡é’ˆ**ï¼‰ï¼Œè¯¥æ•°ç»„æœ‰10ä¸ª`int`å…ƒç´ ï¼š

```
int (*a)[10];
```

å’Œä¸Šä¸€èŠ‚**æŒ‡é’ˆæ•°ç»„**çš„å®šä¹‰`int *a[10];`ç›¸æ¯”ï¼Œä»…ä»…å¤šäº†ä¸€ä¸ª`()`æ‹¬å·ã€‚

`int *a[10];`è¿™ä¸ªå®šä¹‰å¯ä»¥æ‹†æˆä¸¤å¥ï¼š

```c
typedef int *t;
t a[10];
```

`t`ä»£è¡¨`int *`ç±»å‹ï¼Œ`a`åˆ™æ˜¯ç”±è¿™ç§ç±»å‹çš„å…ƒç´ ç»„æˆçš„æ•°ç»„ã€‚`int (*a)[10];`è¿™ä¸ªå®šä¹‰ä¹Ÿå¯ä»¥æ‹†æˆä¸¤å¥ï¼š

```c
typedef int t[10];
t *a;
```

`t`ä»£è¡¨ç”±10ä¸ª`int`ç»„æˆçš„æ•°ç»„ç±»å‹ï¼Œ`a`åˆ™æ˜¯æŒ‡å‘è¿™ç§ç±»å‹çš„æŒ‡é’ˆã€‚

### æ•°ç»„æŒ‡é’ˆçš„ç”¨æ³•

```c
int a[10];
int (*pa)[10] = &a;
```

`a`æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨`&a`è¿™ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œæ•°ç»„ååšå·¦å€¼ï¼Œå–æ•´ä¸ªæ•°ç»„çš„é¦–åœ°å€èµ‹ç»™æŒ‡é’ˆ`pa`ã€‚æ³¨æ„ï¼Œ`&a[0]`è¡¨ç¤ºæ•°ç»„`a`çš„é¦–å…ƒç´ çš„é¦–åœ°å€ï¼Œè€Œ`&a`è¡¨ç¤ºæ•°ç»„`a`çš„é¦–åœ°å€ï¼Œæ˜¾ç„¶è¿™ä¸¤ä¸ªåœ°å€çš„**æ•°å€¼ç›¸åŒ**ï¼Œä½†è¿™ä¸¤ä¸ªè¡¨è¾¾å¼çš„ç±»å‹æ˜¯**ä¸¤ç§ä¸åŒçš„æŒ‡é’ˆç±»å‹**ï¼Œå‰è€…çš„ç±»å‹æ˜¯`int *`ï¼Œè€Œåè€…çš„ç±»å‹æ˜¯`int (*)[10]`ã€‚`*pa`å°±è¡¨ç¤º`pa`æ‰€æŒ‡å‘çš„æ•°ç»„`a`ï¼Œæ‰€ä»¥å–æ•°ç»„çš„`a[0]`å…ƒç´ å¯ä»¥ç”¨è¡¨è¾¾å¼`(*pa)[0]`ã€‚æ³¨æ„åˆ°`*pa`å¯ä»¥å†™æˆ`pa[0]`ï¼Œæ‰€ä»¥`(*pa)[0]`è¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿå¯ä»¥æ”¹å†™æˆ`pa[0][0]`ï¼Œ`pa`å°±åƒä¸€ä¸ªäºŒç»´æ•°ç»„çš„åå­—ï¼Œå®ƒè¡¨ç¤ºä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿä¸‹é¢æŠŠ`pa`å’ŒäºŒç»´æ•°ç»„æ”¾åœ¨ä¸€èµ·åšä¸ªåˆ†æã€‚

`int a[5][10];`å’Œ`int (*pa)[10];`ä¹‹é—´çš„å…³ç³»åŒæ ·ç±»ä¼¼äº`int a[10];`å’Œ`int *pa;`ä¹‹é—´çš„å…³ç³»ï¼š`a`æ˜¯ç”±ä¸€ç§å…ƒç´ ç»„æˆçš„æ•°ç»„ï¼Œ`pa`åˆ™æ˜¯æŒ‡å‘è¿™ç§å…ƒç´ çš„æŒ‡é’ˆã€‚æ‰€ä»¥ï¼Œå¦‚æœ`pa`æŒ‡å‘`a`çš„é¦–å…ƒç´ ï¼š

```c
int a[5][10];
int (*pa)[10] = &a[0];
```

åˆ™`pa[0]`å’Œ`a[0]`å–çš„æ˜¯åŒä¸€ä¸ªå…ƒç´ ï¼Œå”¯ä¸€æ¯”åŸæ¥å¤æ‚çš„åœ°æ–¹åœ¨äºè¿™ä¸ªå…ƒç´ æ˜¯ç”±10ä¸ª`int`ç»„æˆçš„æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸºæœ¬ç±»å‹ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ`pa`å½“æˆäºŒç»´æ•°ç»„åæ¥ä½¿ç”¨ï¼Œ`pa[1][2]`å’Œ`a[1][2]`å–çš„ä¹Ÿæ˜¯åŒä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸”`pa`æ¯”`a`ç”¨èµ·æ¥æ›´çµæ´»ï¼Œæ•°ç»„åä¸æ”¯æŒèµ‹å€¼ã€è‡ªå¢ç­‰è¿ç®—ï¼Œè€ŒæŒ‡é’ˆå¯ä»¥æ”¯æŒï¼Œ`pa++`ä½¿`pa`è·³è¿‡äºŒç»´æ•°ç»„çš„ä¸€è¡Œï¼ˆ40ä¸ªå­—èŠ‚ï¼‰ï¼ŒæŒ‡å‘`a[1]`çš„é¦–åœ°å€ã€‚

## 8 [å‡½æ•°ç±»å‹å’Œå‡½æ•°æŒ‡é’ˆç±»å‹](https://akaedu.github.io/book/ch23s08.html)

1. `void (*f)(const char *) = say_hello;`

`say_hello`æ˜¯ä¸€ç§å‡½æ•°ç±»å‹ï¼Œè€Œå‡½æ•°ç±»å‹å’Œæ•°ç»„ç±»å‹ç±»ä¼¼ï¼Œåšå³å€¼ä½¿ç”¨æ—¶è‡ªåŠ¨è½¬æ¢æˆå‡½æ•°æŒ‡é’ˆç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥èµ‹ç»™`f`ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†™æˆ`void (*f)(const char *) = &say_hello;`ï¼ŒæŠŠå‡½æ•°`say_hello`å…ˆå–åœ°å€å†èµ‹ç»™`f`ï¼Œå°±ä¸éœ€è¦è‡ªåŠ¨ç±»å‹è½¬æ¢äº†ã€‚

2. `f("Guys");`

å¯ä»¥ç›´æ¥é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼Œå¦‚ä¸Šé¢çš„`f("Guys")`ï¼Œä¹Ÿå¯ä»¥å…ˆç”¨`*f`å–å‡ºå®ƒæ‰€æŒ‡çš„å‡½æ•°ç±»å‹ï¼Œå†è°ƒç”¨å‡½æ•°ï¼Œå³`(*f)("Guys")`ã€‚

3. é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°å’Œç›´æ¥è°ƒç”¨å‡½æ•°ç›¸æ¯”æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ç ”ç©¶ä¸€ä¸ªä¾‹å­ã€‚å›é¡¾[ç¬¬ 3 èŠ‚ â€œæ•°æ®ç±»å‹æ ‡å¿—â€](https://akaedu.github.io/book/ch07s03.html#struct.datatag)çš„ä¹ é¢˜1ï¼Œç”±äºç»“æ„ä½“ä¸­å¤šäº†ä¸€ä¸ªç±»å‹å­—æ®µï¼Œéœ€è¦é‡æ–°å®ç°`real_part`ã€`img_part`ã€`magnitude`ã€`angle`è¿™äº›å‡½æ•°ï¼Œä½ å½“æ—¶æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿå¤§æ¦‚æ˜¯è¿™æ ·å§ï¼š

```c
double real_part(struct complex_struct z)
{
	if (z.t == RECTANGULAR)
		return z.a;
	else
		return z.a * cos(z.b);
}
```

ç°åœ¨ç±»å‹å­—æ®µæœ‰ä¸¤ç§å–å€¼ï¼Œ`RECTANGULAR`å’Œ`POLAR`ï¼Œæ¯ä¸ªå‡½æ•°éƒ½è¦`if ... else ...`ï¼Œå¦‚æœç±»å‹å­—æ®µæœ‰ä¸‰ç§å–å€¼å‘¢ï¼Ÿæ¯ä¸ªå‡½æ•°éƒ½è¦`if ... else if ... else`ï¼Œæˆ–è€…`switch ... case ...`ã€‚è¿™æ ·ç»´æŠ¤ä»£ç æ˜¯ä¸å¤Ÿç†æƒ³çš„ï¼Œç°åœ¨æˆ‘ç”¨å‡½æ•°æŒ‡é’ˆç»™å‡ºä¸€ç§å®ç°ï¼š

```c
double rect_real_part(struct complex_struct z)
{
	return z.a;
}

double rect_img_part(struct complex_struct z)
{
	return z.b;
}

double rect_magnitude(struct complex_struct z)
{
	return sqrt(z.a * z.a + z.b * z.b);
}

double rect_angle(struct complex_struct z)
{
	double PI = acos(-1.0);

	if (z.a > 0)
		return atan(z.b / z.a);
	else
		return atan(z.b / z.a) + PI;
}

double pol_real_part(struct complex_struct z)
{
	return z.a * cos(z.b);
}

double pol_img_part(struct complex_struct z)
{
	return z.a * sin(z.b);
}

double pol_magnitude(struct complex_struct z)
{
	return z.a;
}

double pol_angle(struct complex_struct z)
{
	return z.b;
}

double (*real_part_tbl[])(struct complex_struct) = { rect_real_part, pol_real_part };
double (*img_part_tbl[])(struct complex_struct) = { rect_img_part, pol_img_part };
double (*magnitude_tbl[])(struct complex_struct) = { rect_magnitude, pol_magnitude };
double (*angle_tbl[])(struct complex_struct) = { rect_angle, pol_angle };

#define real_part(z) real_part_tbl[z.t](z)
#define img_part(z) img_part_tbl[z.t](z)
#define magnitude(z) magnitude_tbl[z.t](z)
#define angle(z) angle_tbl[z.t](z)
```

å½“è°ƒç”¨`real_part(z)`æ—¶ï¼Œç”¨ç±»å‹å­—æ®µ`z.t`åšç´¢å¼•ï¼Œä»æŒ‡é’ˆæ•°ç»„`real_part_tbl`ä¸­å–å‡ºç›¸åº”çš„å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°`if ... else ...`çš„æ•ˆæœï¼Œä½†ç›¸æ¯”ä¹‹ä¸‹è¿™ç§å®ç°æ›´å¥½ï¼Œæ¯ä¸ªå‡½æ•°éƒ½åªåšä¸€ä»¶äº‹æƒ…ï¼Œè€Œä¸å¿…ç”¨`if ... else ...`å…¼é¡¾å¥½å‡ ä»¶äº‹æƒ…ï¼Œæ¯”å¦‚`rect_real_part`å’Œ`pol_real_part`å„åšå„çš„ï¼Œäº’ç›¸ç‹¬ç«‹ï¼Œè€Œä¸å¿…æŠŠå®ƒä»¬çš„ä»£ç éƒ½è€¦åˆåˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚â€œä½è€¦åˆï¼Œé«˜å†…èšâ€ï¼ˆLow Coupling, High Cohesionï¼‰æ˜¯ç¨‹åºè®¾è®¡çš„ä¸€æ¡åŸºæœ¬åŸåˆ™ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°å¤ç”¨ç°æœ‰ä»£ç ï¼Œä½¿ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€‚å¦‚æœç±»å‹å­—æ®µ`z.t`åˆå¤šäº†ä¸€ç§å–å€¼ï¼Œåªéœ€è¦æ·»åŠ ä¸€ç»„æ–°çš„å‡½æ•°ï¼Œä¿®æ”¹å‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼ŒåŸæœ‰çš„å‡½æ•°ä»ç„¶å¯ä»¥ä¸åŠ æ”¹åŠ¨åœ°å¤ç”¨ã€‚

## 9 [ä¸å®Œå…¨ç±»å‹å’Œå¤æ‚å£°æ˜](https://akaedu.github.io/book/ch23s09.html)

![Cè¯­è¨€ç±»å‹æ€»ç»“](https://akaedu.github.io/book/images/pointer.type.gif)

**ä¸å®Œå…¨ç±»å‹**æ˜¯æš‚æ—¶æ²¡æœ‰å®Œå…¨å®šä¹‰å¥½çš„ç±»å‹ï¼Œ**ç¼–è¯‘å™¨ä¸çŸ¥é“è¿™ç§ç±»å‹è¯¥å å‡ ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´**ï¼Œä¾‹å¦‚ï¼š

```c
struct s;
union u;
char str[];
```

å…·æœ‰ä¸å®Œå…¨ç±»å‹çš„å˜é‡å¯ä»¥é€šè¿‡å¤šæ¬¡å£°æ˜ç»„åˆæˆä¸€ä¸ªå®Œå…¨ç±»å‹ï¼Œæ¯”å¦‚æ•°ç»„`str`å£°æ˜ä¸¤æ¬¡ï¼š

```c
char str[];
char str[10];
```

